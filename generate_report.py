import os
import pandas as pd
from datetime import datetime

def generate_summary_report():
    """
    à¸ªà¸£à¹‰à¸²à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸£à¸¸à¸› Dashboard
    """
    file_path = 'condensate_data.xlsx'
    
    if not os.path.exists(file_path):
        print("âŒ à¹„à¸Ÿà¸¥à¹Œ condensate_data.xlsx à¹„à¸¡à¹ˆà¸à¸š")
        return
    
    # à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
    df = pd.read_excel(file_path, sheet_name='%condensate')
    df['à¸§à¸±à¸™à¸—à¸µà¹ˆ'] = pd.to_datetime(df['à¸§à¸±à¸™à¸—à¸µà¹ˆ'])
    
    # à¸„à¸³à¸™à¸§à¸“à¸ªà¸–à¸´à¸•à¸´
    total_records = len(df)
    total_volume = df['à¸›à¸£à¸´à¸¡à¸²à¸“à¸™à¹‰à¸³à¸„à¸§à¸šà¹à¸™à¹ˆà¸™ (à¸¥à¸´à¸•à¸£)'].sum()
    avg_volume = df['à¸›à¸£à¸´à¸¡à¸²à¸“à¸™à¹‰à¸³à¸„à¸§à¸šà¹à¸™à¹ˆà¸™ (à¸¥à¸´à¸•à¸£)'].mean()
    max_volume = df['à¸›à¸£à¸´à¸¡à¸²à¸“à¸™à¹‰à¸³à¸„à¸§à¸šà¹à¸™à¹ˆà¸™ (à¸¥à¸´à¸•à¸£)'].max()
    min_volume = df['à¸›à¸£à¸´à¸¡à¸²à¸“à¸™à¹‰à¸³à¸„à¸§à¸šà¹à¸™à¹ˆà¸™ (à¸¥à¸´à¸•à¸£)'].min()
    
    avg_temp = df['à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´ (Â°C)'].mean()
    max_temp = df['à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´ (Â°C)'].max()
    min_temp = df['à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´ (Â°C)'].min()
    
    avg_pressure = df['à¸„à¸§à¸²à¸¡à¸”à¸±à¸™ (bar)'].mean()
    max_pressure = df['à¸„à¸§à¸²à¸¡à¸”à¸±à¸™ (bar)'].max()
    min_pressure = df['à¸„à¸§à¸²à¸¡à¸”à¸±à¸™ (bar)'].min()
    
    avg_tds = df['à¸„à¸¸à¸“à¸ à¸²à¸à¸™à¹‰à¸³ (TDS)'].mean()
    max_tds = df['à¸„à¸¸à¸“à¸ à¸²à¸à¸™à¹‰à¸³ (TDS)'].max()
    min_tds = df['à¸„à¸¸à¸“à¸ à¸²à¸à¸™à¹‰à¸³ (TDS)'].min()
    
    normal_count = len(df[df['à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸'] == 'à¸›à¸à¸•à¸´'])
    abnormal_count = len(df[df['à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸'] == 'à¸œà¸´à¸”à¸›à¸à¸•à¸´'])
    normal_percent = (normal_count / total_records * 100) if total_records > 0 else 0
    abnormal_percent = (abnormal_count / total_records * 100) if total_records > 0 else 0
    
    date_range_start = df['à¸§à¸±à¸™à¸—à¸µà¹ˆ'].min().strftime('%Y-%m-%d')
    date_range_end = df['à¸§à¸±à¸™à¸—à¸µà¹ˆ'].max().strftime('%Y-%m-%d')
    
    # à¸ªà¸£à¹‰à¸²à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™
    report = f"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               ğŸ’§ à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸£à¸¸à¸›à¸™à¹‰à¸³à¸„à¸§à¸šà¹à¸™à¹ˆà¸™                           â•‘
â•‘           Condensate Monitoring Summary Report                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹ˆà¸§à¹„à¸› (General Information)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“… à¸Šà¹ˆà¸§à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆ: {date_range_start} à¸–à¸¶à¸‡ {date_range_end}
  ğŸ“ˆ à¸ˆà¸³à¸™à¸§à¸™à¸£à¸²à¸¢à¸à¸²à¸£: {total_records} à¸šà¸±à¸™à¸—à¸¶à¸
  â° à¸ªà¸£à¹‰à¸²à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

ğŸ“‹ à¸ªà¸–à¸´à¸•à¸´à¸›à¸£à¸´à¸¡à¸²à¸“à¸™à¹‰à¸³à¸„à¸§à¸šà¹à¸™à¹ˆà¸™ (Condensate Volume Statistics)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ’§ à¸›à¸£à¸´à¸¡à¸²à¸“à¸£à¸§à¸¡:        {total_volume:>12.2f} à¸¥à¸´à¸•à¸£
  ğŸ“Š à¸›à¸£à¸´à¸¡à¸²à¸“à¹€à¸‰à¸¥à¸µà¹ˆà¸¢:      {avg_volume:>12.2f} à¸¥à¸´à¸•à¸£/à¸§à¸±à¸™
  ğŸ“ˆ à¸›à¸£à¸´à¸¡à¸²à¸“à¸ªà¸¹à¸‡à¸ªà¸¸à¸”:      {max_volume:>12.2f} à¸¥à¸´à¸•à¸£
  ğŸ“‰ à¸›à¸£à¸´à¸¡à¸²à¸“à¸•à¹ˆà¸³à¸ªà¸¸à¸”:      {min_volume:>12.2f} à¸¥à¸´à¸•à¸£

ğŸŒ¡ï¸ à¸ªà¸–à¸´à¸•à¸´à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´ (Temperature Statistics)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“Š à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´à¹€à¸‰à¸¥à¸µà¹ˆà¸¢:    {avg_temp:>12.1f} Â°C
  ğŸ“ˆ à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´à¸ªà¸¹à¸‡à¸ªà¸¸à¸”:    {max_temp:>12.1f} Â°C
  ğŸ“‰ à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´à¸•à¹ˆà¸³à¸ªà¸¸à¸”:    {min_temp:>12.1f} Â°C

âš™ï¸ à¸ªà¸–à¸´à¸•à¸´à¸„à¸§à¸²à¸¡à¸”à¸±à¸™ (Pressure Statistics)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“Š à¸„à¸§à¸²à¸¡à¸”à¸±à¸™à¹€à¸‰à¸¥à¸µà¹ˆà¸¢:    {avg_pressure:>12.2f} bar
  ğŸ“ˆ à¸„à¸§à¸²à¸¡à¸”à¸±à¸™à¸ªà¸¹à¸‡à¸ªà¸¸à¸”:    {max_pressure:>12.2f} bar
  ğŸ“‰ à¸„à¸§à¸²à¸¡à¸”à¸±à¸™à¸•à¹ˆà¸³à¸ªà¸¸à¸”:    {min_pressure:>12.2f} bar

ğŸ’§ à¸ªà¸–à¸´à¸•à¸´à¸„à¸¸à¸“à¸ à¸²à¸à¸™à¹‰à¸³ (Water Quality - TDS Statistics)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“Š TDS à¹€à¸‰à¸¥à¸µà¹ˆà¸¢:       {avg_tds:>12.0f} ppm
  ğŸ“ˆ TDS à¸ªà¸¹à¸‡à¸ªà¸¸à¸”:       {max_tds:>12.0f} ppm
  ğŸ“‰ TDS à¸•à¹ˆà¸³à¸ªà¸¸à¸”:       {min_tds:>12.0f} ppm

âœ… à¸ªà¸–à¸´à¸•à¸´à¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™ (Status Statistics)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  âœ… à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸›à¸à¸•à¸´:     {normal_count:>6} à¸šà¸±à¸™à¸—à¸¶à¸ ({normal_percent:>5.1f}%)
  âš ï¸  à¸œà¸´à¸”à¸›à¸à¸•à¸´:         {abnormal_count:>6} à¸šà¸±à¸™à¸—à¸¶à¸ ({abnormal_percent:>5.1f}%)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    à¸ªà¸£à¸¸à¸›à¸œà¸¥à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸²à¸¡                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Œ à¸ˆà¸¸à¸”à¸—à¸µà¹ˆà¸„à¸§à¸£à¸ªà¸±à¸‡à¹€à¸à¸•:
"""
    
    # à¹€à¸à¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡
    if abnormal_percent > 10:
        report += f"\n  âš ï¸  à¸¡à¸µà¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œà¸œà¸´à¸”à¸›à¸à¸•à¸´ {abnormal_percent:.1f}% à¸„à¸§à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸£à¸°à¸šà¸š"
    
    if avg_tds > 1500:
        report += f"\n  âš ï¸  TDS à¸ªà¸¹à¸‡à¸à¸§à¹ˆà¸²à¸›à¸à¸•à¸´ ({avg_tds:.0f} ppm) à¸„à¸§à¸£à¸—à¸³à¸à¸²à¸£à¸¥à¹‰à¸²à¸‡à¸£à¸°à¸šà¸š"
    
    if max_pressure > 7:
        report += f"\n  âš ï¸  à¸„à¸§à¸²à¸¡à¸”à¸±à¸™à¸ªà¸¹à¸‡à¸ªà¸¸à¸” {max_pressure:.2f} bar à¸„à¸§à¸£à¸•à¸£à¸§à¸ˆà¹€à¸Šà¹‡à¸„"
    
    if max_temp > 95:
        report += f"\n  âš ï¸  à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´à¸ªà¸¹à¸‡à¸ªà¸¸à¸” {max_temp:.1f}Â°C à¸„à¸§à¸£à¸•à¸£à¸§à¸ˆà¸«à¸¡à¹‰à¸­à¹„à¸­à¸™à¹‰à¸³"
    
    if normal_percent >= 90:
        report += f"\n  âœ… à¸£à¸°à¸šà¸šà¸—à¸³à¸‡à¸²à¸™à¸›à¸à¸•à¸´ {normal_percent:.1f}%"
    
    report += """

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
à¸£à¸²à¸¢à¸‡à¸²à¸™à¸™à¸µà¹‰à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸”à¸¢à¸£à¸°à¸šà¸šà¸•à¸´à¸”à¸•à¸²à¸¡à¸™à¹‰à¸³à¸„à¸§à¸šà¹à¸™à¹ˆà¸™ (Condensate Monitoring System)
à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸£à¹‰à¸²à¸‡: {date}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".format(date=datetime.now().strftime('%Y-%m-%d %H:%M:%S'))
    
    print(report)
    
    # à¸šà¸±à¸™à¸—à¸¶à¸à¸¥à¸‡à¹„à¸Ÿà¸¥à¹Œ
    report_file = f"condensate_report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.txt"
    with open(report_file, 'w', encoding='utf-8') as f:
        f.write(report)
    
    print(f"\nğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸à¸£à¸²à¸¢à¸‡à¸²à¸™à¹€à¸›à¹‡à¸™à¹„à¸Ÿà¸¥à¹Œ: {report_file}")

if __name__ == "__main__":
    generate_summary_report()
